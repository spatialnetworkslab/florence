export default function (point, geometry) {
  switch (geometry.type) {
    case 'Polygon': return pointInPolygon(point, geometry)
    case 'MultiPolygon': return pointInMultiPolygon(point, geometry)
  }
}

function pointInPolygon (point, geometry) {
  let coordinates = geometry.coordinates
  let outerRing = coordinates[0]

  if (!pointInRing(point, outerRing)) return false

  for (let i = 1; i < coordinates.length; i++) {
    let hole = coordinates[i]

    if (pointInRing(point, hole)) return false
  }

  return true
}

function pointInMultiPolygon (point, geometry) {
  let coordinates = geometry.coordinates

  for (let i = 0; i < coordinates.length; i++) {
    let polygon = coordinates[i]

    if (pointInPolygon(point, polygon)) return true
  }

  return false
}

function pointInRing (point, coordinates) {
  let x = point[0]
  let y = point[1]
  let inside = false

  for (let i = 0, j = coordinates.length - 1; i < coordinates.length; j = i++) {
    let xi = coordinates[i][0]
    let yi = coordinates[i][1]
    let xj = coordinates[j][0]
    let yj = coordinates[j][1]
    let intersect = ((yi > y) !== (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi)
    if (intersect) { inside = !inside }
  }

  return inside
}
